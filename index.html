<script>
    // 1. YOUR LATEST KEY
    const KEY = "AIzaSyDMsEWb684y0FzptAJ8vT5HMxlahV2hWNg";
    
    // 2. UPDATED STABLE URL & MODEL
    // We are switching to the v1beta endpoint with the 2.0 model for maximum compatibility
    const URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

    async function askSabrina() {
        const input = document.getElementById('userInput');
        const chat = document.getElementById('chat');
        const text = input.value.trim();

        if (!text) return;

        // Add User Message
        chat.innerHTML += `<div class="bubble user">${text}</div>`;
        input.value = "";
        chat.scrollTop = chat.scrollHeight;

        // Create AI Bubble
        const tempId = "ai-" + Date.now();
        chat.innerHTML += `<div class="bubble ai" id="${tempId}">Neural link establishing...</div>`;
        chat.scrollTop = chat.scrollHeight;

        try {
            const response = await fetch(`${URL}?key=${KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Your name is Sabrina. You are a genius AI. Solve: " + text }] }]
                })
            });

            const data = await response.json();
            const aiBubble = document.getElementById(tempId);

            if (data.candidates && data.candidates[0].content) {
                const result = data.candidates[0].content.parts[0].text;
                aiBubble.innerHTML = marked.parse(result);
            } else {
                // This will show exactly what Google is complaining about if it fails
                const errMsg = data.error ? data.error.message : "Handshake rejected.";
                aiBubble.innerHTML = `<div style="color:#ff4444"><b>Sabrina Status:</b> ${errMsg}</div>`;
            }
        } catch (err) {
            document.getElementById(tempId).innerHTML = "Connection Error. Ensure GitHub Pages is active.";
        }
        chat.scrollTop = chat.scrollHeight;
    }

    // Enter Key Support
    document.getElementById('userInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); askSabrina(); }
    });
</script>
